---
title: 博客升级搬迁
date: 2023-03-28 13:51:21
tags: Tech
---

近日将博客使用的 Next 主题从好久不更新的 [Github 仓库](https://github.com/theme-next/hexo-theme-next) 部署方式切到了 `npm`，也获得了版本的升级。并且我现在把博客在 [Railway](railway.app) 上以 Docker 加 Nginx 的方式托管，不再用 Github Pages 了。

原来的用的好好的，为什么要多此一举呢？本质原因可能是因为我要整理一下目前正在用的域名，打算以后都使用 `junyang.me` 这个域名。但是原先的 `jyzhang.xyz` 因为也分享给了别人，所以要保持很长一段时间的可用。Github Pages 并不能使用多个自定义域名，于是想要搬迁。还有一个次要原因，可能是因为我最近玩 OpenAI API，搭了个 GPT-3.5-turbo 的镜像站给家人用，用 Railway 部署了 [ChatGPT WEB](https://github.com/Chanzhaoyu/chatgpt-web)，感觉 Railway 很好用，于是购买了 plan。心想买都买了就把博客搞过来吧。

## 为 Hexo 编写 Dockerfile

Hexo 生成的是静态网站，如果不想在静态页面托管处使用，可以搭建 Nginx 服务器。Railway 上的话就用 Docker 部署 Nginx 即可（实际上也不支持别的方式）。我直接在 Hexo 的博客仓库里加了个 Dockerfile，这样每次 Github commit 之后就会自动触发构建，更新到网站上。

```Dockerfile
FROM node:latest
MAINTAINER junyangzhang, user@junyang.me

# install hexo
RUN npm install hexo-cli -g
WORKDIR /root/src
COPY . /root/src
RUN npm install

# install pandoc
ADD https://github.com/jgm/pandoc/releases/download/3.1.1/pandoc-3.1.1-1-amd64.deb .
RUN dpkg -i pandoc-3.1.1-1-amd64.deb

# configure nginx
ADD https://nginx.org/download/nginx-1.20.1.tar.gz .
RUN tar -xvf nginx-1.20.1.tar.gz && cd nginx-1.20.1 && ./configure && make && make install
RUN rm -f /usr/local/nginx/conf/nginx.conf
COPY nginx.conf /usr/local/nginx/conf/nginx.conf
RUN mkdir -p /var/logs/ && touch /var/logs/error.log && touch /var/logs/nginx.pid

# make inplace style changes
RUN chmod +x customization/alter_styles.sh && ./customization/alter_styles.sh

# build the site
RUN hexo generate

RUN mkdir -p /usr/share/nginx/html/ && cp -r public /usr/share/nginx/html/

# finishing
RUN dpkg -r pandoc && rm -rf /root/src

# hexo default port
EXPOSE 4000

# run hexo server
ENTRYPOINT ["/usr/local/nginx/sbin/nginx", "-g", "daemon off;"]
```

## 升级 Next

## 评论系统迁移
